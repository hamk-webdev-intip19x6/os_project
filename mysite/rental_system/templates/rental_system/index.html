{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        {% if types %}
        <div class="col-lg-2 col-12">
            <nav id="sidebar">
                <!--searchbar-->       
                <form name="searchform" method="GET">
                    <input type="text" class="form-control" name="search" id="search" placeholder="Search" minlength="3"
                        autocomplete="off" required>
                </form>
             
                <ul class="nav flex-column">
                    {% for type in types %}
                    <li>
                        <a href="?search={{ type }}" class="nav-link">{{ type }}</a>
                    </li>
                    {% endfor %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                            aria-haspopup="true" aria-expanded="false">Genres</a>
                        <div class="dropdown-menu">
                            {% for genre in genres %}
                            <a class="dropdown-item" href="?search={{ genre }}">{{ genre }}</a>
                            {% endfor %}
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
        {% endif %}
        <!--works-->
        {% if works %}
        <div class="col-lg-10 col-12 overflow-auto">
            {% for work in works %}
            {% if query in work.title.casefold or query in work.desc or query in work.creators.all|join:", " or query in work.genres.all|join:", "  %}
            <div class="card">
                <div class="card-body">
                    <a href="work/{{ work.id }}">
                        <h5 class="card-title">{{ work.title }}</h5>
                    </a>
                    <p class="card-text"><small class="text-muted">{{ work.genres.all|join:", " }}</small></p>
                    <p class="card-text"><small class="text-muted">{{ work.creators.all|join:", " }}</small></p>
                    <p class="card-text">{{ work.desc }}</p>
                </div>
            </div>
            <br>
            {% endif %}
            {% endfor %}

            {% if not query %}
            <div class="col-10">
                {% for work in works %}
                <div class="card">
                    <div class="card-body">
                        <a href="work/{{ work.id }}">
                            <h5 class="card-title">{{ work.title }}</h5>
                        </a>
                        <p class="card-text"><small class="text-muted">{{ work.genres.all|join:", " }}</small></p>
                        <p class="card-text"><small class="text-muted">{{ work.creators.all|join:", " }}</small></p>
                        <p class="card-text">{{ work.desc }}</p>
                    </div>
                </div>
                <br>
                {% endfor %}
                {% endif %}
            </div>
        </div>
        {% else %}
        <p>No works are available.</p>
        {% endif %}
    </div>
    <div class="pagination">
        <span class="step-links">
            {% if works.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ works.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ works.number }} of {{ works.paginator.num_pages }}.
            </span>

            {% if works.has_next %}
            <a href="?page={{ works.next_page_number }}">next</a>
            <a href="?page={{ works.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
    {% endblock %}