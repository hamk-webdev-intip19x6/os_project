{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        {% if types %}
        <div class="col-lg-2 col-12">
            <nav id="sidebar">
                 <!--searchbar-->
                 <form name="searchform"  onsubmit="return Validate()" method="get">
                    <input type="text" class="form-control" name="search" id="search" placeholder="Search" minlength="3" autocomplete="off">
                </form>

                <ul class="list-unstyled components">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                            aria-haspopup="true" aria-expanded="false">Genres</a>
                        <div class="dropdown-menu">
                            {% for genre in genres %}
                            <a class="dropdown-item" href="?search={{ genre }}">{{ genre }}</a>
                            {% endfor %}
                        </div>
                    </li>
                    {% for type in types %}
                    <li>
                        <a href="?search={{ type }}">{{ type }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </nav>
        </div>
        {% endif %}
        <!--works-->
        {% if works %}
            <div class="col-lg-10 col-12">
            {% for work in works %}
            {% if query in work.title.casefold or query in work.desc or query in work.creators.all|join:", " or query in work.genres.all|join:", "  %}
            <div class="card">
                <div class="card-body">
                    <a href="work/{{ work.id }}">
                        <h5 class="card-title">{{ work.title }}</h5>
                    </a>
                    <p class="card-text"><small class="text-muted">{{ work.genres.all|join:", " }}</small></p>
                    <p class="card-text"><small class="text-muted">{{ work.creators.all|join:", " }}</small></p>
                    <p class="card-text">{{ work.desc }}</p>
                </div>
            </div>
            <br>
            {% endif %}
            {% endfor %}

        {% if not query %}
            <div class="col-10">
            {% for work in works %}
            <div class="card">
                <div class="card-body">
                    <a href="work/{{ work.id }}">
                        <h5 class="card-title">{{ work.title }}</h5>
                    </a>
                    <p class="card-text"><small class="text-muted">{{ work.genres.all|join:", " }}</small></p>
                    <p class="card-text"><small class="text-muted">{{ work.creators.all|join:", " }}</small></p>
                    <p class="card-text">{{ work.desc }}</p>
                </div>
            </div>
            <br>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% else %}
    <p>No works are available.</p>
    {% endif %}
</div>
<script>
    //ghetto, TODO: fix
    document.getElementById("searchbar").value = "{{query}}"

    function Validate() {
    var x = document.forms["searchform"]["search"].value;
    if (x == "") {
        alert("Fill the form");
    return false;
     }
    } 


</script>
{% endblock %}